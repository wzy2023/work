import{d as D,r as p,U as O,a2 as T,y as $,z as u,C as a,E as F,x as w,H as r,aa as R,a9 as V,K as E,L as h,M as S,G as L,D as x,A as P,B as j,I as G,F as H,J as M,O as K,ac as J,h as q,R as Q,ad as W,l as i,ae as X,af as k,ag as z,ah as A,ai as _,aj as Y}from"./index-fbbac701.js";import{N as U}from"./InputNumber-182875ff.js";import{N as Z,a as ee,b as te}from"./DataTable-1f6f0c54.js";import{N as I}from"./Space-aba0b5a7.js";import{N as B}from"./Time-e45edf09.js";import"./Add-e4db921f.js";import"./Forward-3cd0631b.js";import"./Dropdown-178d9d7e.js";import"./FocusDetector-10318a71.js";import"./index-f5ac7aca.js";const ae={class:"flex flex-row justify-end"},re=D({__name:"edit",props:{currentItem:null,show:{type:Boolean}},emits:["hide","success"],setup(C,{emit:v}){const l=C,c=p(0),n=p(""),y=p(0),d=[{label:"普通用户",value:1},{label:"分成者",value:2}],f=O(),g=()=>{v("hide",!1)};T(()=>{var m,o,s;c.value=(m=l==null?void 0:l.currentItem)==null?void 0:m.count,n.value=(o=l==null?void 0:l.currentItem)==null?void 0:o.role,c.income=(s=l==null?void 0:l.currentItem)==null?void 0:s.income});const b=async()=>{var m;try{await J({uuid:(m=l==null?void 0:l.currentItem)==null?void 0:m.uuid,userInfo:{count:c.value,role:n.value,income:y.value}}),f.success("编辑成功~"),v("success"),g()}catch{f.error("编辑失败")}};return(m,o)=>l.show?(w(),$(a(K),{key:0,show:C.show},{default:u(()=>[r(a(M),{style:{width:"600px"},title:"编辑",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{"header-extra":u(()=>[r(a(R),{onClick:g},{default:u(()=>[r(a(V),{icon:"ri-close-fill"})]),_:1})]),footer:u(()=>[E("div",ae,[r(a(I),{size:"small"},{default:u(()=>[r(a(h),{onClick:g},{default:u(()=>[S("取消")]),_:1}),r(a(h),{type:"primary",onClick:b},{default:u(()=>[S("确定")]),_:1})]),_:1})])]),default:u(()=>[r(a(L),{"label-placement":"left"},{default:u(()=>[r(a(x),{span:2,label:"点数"},{default:u(()=>[r(a(U),{value:c.value,"onUpdate:value":o[0]||(o[0]=s=>c.value=s)},null,8,["value"])]),_:1}),r(a(x),{span:2,label:"角色"},{default:u(()=>[r(a(Z),{value:n.value,"onUpdate:value":o[1]||(o[1]=s=>n.value=s),name:"radiogroup"},{default:u(()=>[r(a(I),null,{default:u(()=>[(w(),P(H,null,j(d,s=>r(a(ee),{key:s.value,value:s.value},{default:u(()=>[S(G(s.label),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["value"])]),_:1}),r(a(x),{span:2,label:"收益"},{default:u(()=>[r(a(U),{value:y.value,"onUpdate:value":o[2]||(o[2]=s=>y.value=s)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])):F("",!0)}}),fe=D({__name:"index",setup(C){const v=O(),l=p(!1),c=p(!1),n=p({updateAt:"descend"}),y=p(null),d=p({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[10,20,50,100],onChange:e=>{d.value.page=e,f()},onUpdatePageSize:e=>{d.value.pageSize=e,d.value.page=1,f()},prefix:e=>`共 ${e.itemCount} 条`}),f=async()=>{try{c.value=!0;const{data:e}=await W({page:{current:d.value.page,pageSize:d.value.pageSize},sort:n.value});if(c.value=!1,!e)return;m.value=e.list,d.value.itemCount=e.total}catch(e){v.error(e==null?void 0:e.message)}},g=()=>{setTimeout(()=>{f()},300)},b=async(e,t)=>{if(!(!e||!t))try{await Y({uuid:e,status:t}),v.success("编辑成功~"),g()}catch{v.error("编辑失败")}},m=p([]),o=q(()=>[{title:"uuid",key:"uuid",align:"center"},{title:"用户",key:"wx",align:"center",render:e=>i(X,{userInfo:e,showDetail:!0})},{title:"昵称",key:"wx.nickname",align:"center"},{title:"现有点数",key:"count",align:"center",sortOrder:n.value.count,sorter:(e,t)=>e.count-t.count,render:e=>i(k,{type:"default"},()=>e.count)},{title:"使用点数",key:"useCount",align:"center",sortOrder:n.value.useCount,sorter:(e,t)=>e.useCount-t.useCount,render:e=>i(k,{type:"default"},()=>e.useCount)},{title:"支付金额",key:"payPrice",align:"center",sortOrder:n.value.payPrice,sorter:(e,t)=>e.payPrice-t.payPrice,render:e=>i(k,{type:"default"},()=>e.payPrice)},{title:"收益",key:"income",align:"center",sortOrder:n.value.income,sorter:(e,t)=>e.income-t.income,render:e=>i(k,{type:"default"},()=>e.income)},{title:"状态",key:"status",align:"center",render:e=>i(k,{type:z[e.status].type},()=>z[e.status].label)},{title:"角色",key:"role",align:"center",render:e=>{var t;return i(k,{type:(t=A[e.role])==null?void 0:t.type},()=>{var N;return(N=A[e.role])==null?void 0:N.label})}},{title:"注册时间",key:"createAt",align:"center",sortOrder:n.value.createAt,sorter:(e,t)=>e.createAt-t.createAt,render:e=>i(B,{time:Number(e.createAt)})},{title:"上次登陆时间",key:"updateAt",align:"center",sortOrder:n.value.updateAt,sorter:(e,t)=>e.updateAt-t.updateAt,render:e=>i(B,{time:Number(e.updateAt)})},{title:"操作",key:"action",align:"center",width:150,render:e=>i(I,{},()=>[i(h,{key:"edit",type:"primary",size:"small",onClick:()=>{y.value={...e},l.value=!0}},"编辑"),i(h,{key:"status",type:"info",size:"small",type:e.status===_.Normal?"error":"success",onClick:()=>b(e.uuid,e.status===_.Normal?_.Disabled:_.Normal)},e.status===_.Normal?"禁用":"启用")])}]);Q(()=>{f()});const s=e=>{if(!e.order){n.value={};return}n.value={[e.columnKey]:e.order},f()};return(e,t)=>(w(),P("div",null,[r(a(M),{title:"用户管理",size:"small"},{default:u(()=>[r(a(te),{remote:"",loading:c.value,columns:a(o),data:m.value,bordered:!1,pagination:d.value,"onUpdate:sorter":s,"scroll-x":"1350"},null,8,["loading","columns","data","pagination"])]),_:1}),r(re,{show:l.value,currentItem:y.value,onHide:t[0]||(t[0]=N=>l.value=N),onSuccess:g},null,8,["show","currentItem"])]))}});export{fe as default};
