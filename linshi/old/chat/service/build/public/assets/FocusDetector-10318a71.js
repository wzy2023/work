import{cB as ee,cC as te,cD as ne,am as ie,ce as E,cE as le,br as H,al as se,d as X,bS as oe,bT as re,R as ae,cF as ue,cb as ce,h as R,r as z,bp as fe,bg as U,l as T,aq as de,c0 as Y,bU as V,ck as he,bf as L}from"./index-fbbac701.js";function ye(l,n){let{target:i}=l;for(;i;){if(i.dataset&&i.dataset[n]!==void 0)return!0;i=i.parentElement}return!1}function pe(l={},n){const i=ee({ctrl:!1,command:!1,win:!1,shift:!1,tab:!1}),{keydown:u,keyup:s}=l,o=a=>{switch(a.key){case"Control":i.ctrl=!0;break;case"Meta":i.command=!0,i.win=!0;break;case"Shift":i.shift=!0;break;case"Tab":i.tab=!0;break}u!==void 0&&Object.keys(u).forEach(g=>{if(g!==a.key)return;const m=u[g];if(typeof m=="function")m(a);else{const{stop:w=!1,prevent:S=!1}=m;w&&a.stopPropagation(),S&&a.preventDefault(),m.handler(a)}})},b=a=>{switch(a.key){case"Control":i.ctrl=!1;break;case"Meta":i.command=!1,i.win=!1;break;case"Shift":i.shift=!1;break;case"Tab":i.tab=!1;break}s!==void 0&&Object.keys(s).forEach(g=>{if(g!==a.key)return;const m=s[g];if(typeof m=="function")m(a);else{const{stop:w=!1,prevent:S=!1}=m;w&&a.stopPropagation(),S&&a.preventDefault(),m.handler(a)}})},y=()=>{(n===void 0||n.value)&&(H("keydown",document,o),H("keyup",document,b)),n!==void 0&&se(n,a=>{a?(H("keydown",document,o),H("keyup",document,b)):(E("keydown",document,o),E("keyup",document,b))})};return te()?(ne(y),ie(()=>{(n===void 0||n.value)&&(E("keydown",document,o),E("keyup",document,b))})):y(),le(i)}function $(l){return l&-l}class me{constructor(n,i){this.l=n,this.min=i;const u=new Array(n+1);for(let s=0;s<n+1;++s)u[s]=0;this.ft=u}add(n,i){if(i===0)return;const{l:u,ft:s}=this;for(n+=1;n<=u;)s[n]+=i,n+=$(n)}get(n){return this.sum(n+1)-this.sum(n)}sum(n){if(n===void 0&&(n=this.l),n<=0)return 0;const{ft:i,min:u,l:s}=this;if(n>s)throw new Error("[FinweckTree.sum]: `i` is larger than length.");let o=n*u;for(;n>0;)o+=i[n],n-=$(n);return o}getBound(n){let i=0,u=this.l;for(;u>i;){const s=Math.floor((i+u)/2),o=this.sum(s);if(o>n){u=s;continue}else if(o<n){if(i===s)return this.sum(i+1)<=n?i+1:s;i=s}else return s}return i}}let N;function ve(){return N===void 0&&("matchMedia"in window?N=window.matchMedia("(pointer:coarse)").matches:N=!1),N}let D;function K(){return D===void 0&&(D="chrome"in window?window.devicePixelRatio:1),D}const ge=V(".v-vl",{maxHeight:"inherit",height:"100%",overflow:"auto",minWidth:"1px"},[V("&:not(.v-vl--show-scrollbar)",{scrollbarWidth:"none"},[V("&::-webkit-scrollbar, &::-webkit-scrollbar-track-piece, &::-webkit-scrollbar-thumb",{width:0,height:0,display:"none"})])]),we=X({name:"VirtualList",inheritAttrs:!1,props:{showScrollbar:{type:Boolean,default:!0},items:{type:Array,default:()=>[]},itemSize:{type:Number,required:!0},itemResizable:Boolean,itemsStyle:[String,Object],visibleItemsTag:{type:[String,Object],default:"div"},visibleItemsProps:Object,ignoreItemResize:Boolean,onScroll:Function,onWheel:Function,onResize:Function,defaultScrollKey:[Number,String],defaultScrollIndex:Number,keyField:{type:String,default:"key"},paddingTop:{type:[Number,String],default:0},paddingBottom:{type:[Number,String],default:0}},setup(l){const n=oe();ge.mount({id:"vueuc/virtual-list",head:!0,anchorMetaName:re,ssr:n}),ae(()=>{const{defaultScrollIndex:e,defaultScrollKey:t}=l;e!=null?B({index:e}):t!=null&&B({key:t})});let i=!1,u=!1;ue(()=>{if(i=!1,!u){u=!0;return}B({top:w.value,left:m})}),ce(()=>{i=!0,u||(u=!0)});const s=R(()=>{const e=new Map,{keyField:t}=l;return l.items.forEach((r,f)=>{e.set(r[t],f)}),e}),o=z(null),b=z(void 0),y=new Map,a=R(()=>{const{items:e,itemSize:t,keyField:r}=l,f=new me(e.length,t);return e.forEach((d,h)=>{const c=d[r],v=y.get(c);v!==void 0&&f.add(h,v)}),f}),g=z(0);let m=0;const w=z(0),S=fe(()=>Math.max(a.value.getBound(w.value-U(l.paddingTop))-1,0)),q=R(()=>{const{value:e}=b;if(e===void 0)return[];const{items:t,itemSize:r}=l,f=S.value,d=Math.min(f+Math.ceil(e/r+1),t.length-1),h=[];for(let c=f;c<=d;++c)h.push(t[c]);return h}),B=(e,t)=>{if(typeof e=="number"){M(e,t,"auto");return}const{left:r,top:f,index:d,key:h,position:c,behavior:v,debounce:p=!0}=e;if(r!==void 0||f!==void 0)M(r,f,v);else if(d!==void 0)P(d,v,p);else if(h!==void 0){const W=s.value.get(h);W!==void 0&&P(W,v,p)}else c==="bottom"?M(0,Number.MAX_SAFE_INTEGER,v):c==="top"&&M(0,0,v)};let I,F=null;function P(e,t,r){const{value:f}=a,d=f.sum(e)+U(l.paddingTop);if(!r)o.value.scrollTo({left:0,top:d,behavior:t});else{I=e,F!==null&&window.clearTimeout(F),F=window.setTimeout(()=>{I=void 0,F=null},16);const{scrollTop:h,offsetHeight:c}=o.value;if(d>h){const v=f.get(e);d+v<=h+c||o.value.scrollTo({left:0,top:d+v-c,behavior:t})}else o.value.scrollTo({left:0,top:d,behavior:t})}}function M(e,t,r){o.value.scrollTo({left:e,top:t,behavior:r})}function G(e,t){var r,f,d;if(i||l.ignoreItemResize||C(t.target))return;const{value:h}=a,c=s.value.get(e),v=h.get(c),p=(d=(f=(r=t.borderBoxSize)===null||r===void 0?void 0:r[0])===null||f===void 0?void 0:f.blockSize)!==null&&d!==void 0?d:t.contentRect.height;if(p===v)return;p-l.itemSize===0?y.delete(e):y.set(e,p-l.itemSize);const x=p-v;if(x===0)return;h.add(c,x);const k=o.value;if(k!=null){if(I===void 0){const _=h.sum(c);k.scrollTop>_&&k.scrollBy(0,x)}else if(c<I)k.scrollBy(0,x);else if(c===I){const _=h.sum(c);p+_>k.scrollTop+k.offsetHeight&&k.scrollBy(0,x)}A()}g.value++}const j=!ve();let O=!1;function J(e){var t;(t=l.onScroll)===null||t===void 0||t.call(l,e),(!j||!O)&&A()}function Q(e){var t;if((t=l.onWheel)===null||t===void 0||t.call(l,e),j){const r=o.value;if(r!=null){if(e.deltaX===0&&(r.scrollTop===0&&e.deltaY<=0||r.scrollTop+r.offsetHeight>=r.scrollHeight&&e.deltaY>=0))return;e.preventDefault(),r.scrollTop+=e.deltaY/K(),r.scrollLeft+=e.deltaX/K(),A(),O=!0,he(()=>{O=!1})}}}function Z(e){if(i||C(e.target)||e.contentRect.height===b.value)return;b.value=e.contentRect.height;const{onResize:t}=l;t!==void 0&&t(e)}function A(){const{value:e}=o;e!=null&&(w.value=e.scrollTop,m=e.scrollLeft)}function C(e){let t=e;for(;t!==null;){if(t.style.display==="none")return!0;t=t.parentElement}return!1}return{listHeight:b,listStyle:{overflow:"auto"},keyToIndex:s,itemsStyle:R(()=>{const{itemResizable:e}=l,t=L(a.value.sum());return g.value,[l.itemsStyle,{boxSizing:"content-box",height:e?"":t,minHeight:e?t:"",paddingTop:L(l.paddingTop),paddingBottom:L(l.paddingBottom)}]}),visibleItemsStyle:R(()=>(g.value,{transform:`translateY(${L(a.value.sum(S.value))})`})),viewportItems:q,listElRef:o,itemsElRef:z(null),scrollTo:B,handleListResize:Z,handleListScroll:J,handleListWheel:Q,handleItemResize:G}},render(){const{itemResizable:l,keyField:n,keyToIndex:i,visibleItemsTag:u}=this;return T(Y,{onResize:this.handleListResize},{default:()=>{var s,o;return T("div",de(this.$attrs,{class:["v-vl",this.showScrollbar&&"v-vl--show-scrollbar"],onScroll:this.handleListScroll,onWheel:this.handleListWheel,ref:"listElRef"}),[this.items.length!==0?T("div",{ref:"itemsElRef",class:"v-vl-items",style:this.itemsStyle},[T(u,Object.assign({class:"v-vl-visible-items",style:this.visibleItemsStyle},this.visibleItemsProps),{default:()=>this.viewportItems.map(b=>{const y=b[n],a=i.get(y),g=this.$slots.default({item:b,index:a})[0];return l?T(Y,{key:y,onResize:m=>this.handleItemResize(y,m)},{default:()=>g}):(g.key=y,g)})})]):(o=(s=this.$slots).empty)===null||o===void 0?void 0:o.call(s)])}})}}),ke=X({props:{onFocus:Function,onBlur:Function},setup(l){return()=>T("div",{style:"width: 0; height: 0",tabindex:0,onFocus:l.onFocus,onBlur:l.onBlur})}});export{ke as F,we as V,ye as h,pe as u};
